% vim:ts=4:sw=4
% Copyright (c) 2014 Casper Ti. Vector
% Public domain.

\begin{cabstract}
现在有许多关于自动修改程序的研究，例如程序修复工具、程序迁移工具等等。我们把这类工具统称为\emph{程序编辑工具}。
同时，许多程序都需要使用C预处理器，比方说C，C++和Objective-C开发的程序。由于预处理器的处理十分复杂，
在有C预处理器的情况下，许多程序编辑工具无法给出可靠的操作。
甚至有的程序编辑工具直接放弃处理未预处理的代码。

本文中我们提出了一种轻量级的双向C预处理器算法。它可以帮助程序编辑工具免去处理C预处理器的烦恼。程序编辑工具现在只需关注预处理后的代码，而我们的双向预处理器可以自动地为编辑工具把修改反向映射到预处理前的代码上。我们在理论上和实践中证明了我们生成的修改时正确的且尽可能地保留源代码的完整性。我们在Linux内核代码上生成修改操作并通过实验验证了我们的方法。实验结果显示我们的方法可行且有效。
\end{cabstract}

\begin{eabstract}
Many tools directly change programs, such as bug-fixing tools, program migration tools, etc. We call them \emph{program-editing tools}. On the other hand, many programing use the C preprocessor, such as C, C++, and Objective-C. Because of the complexity of preprocessors, many program-editing tools either fail to produce sound results under the presence of preprocessor directives, or give up completely and deal only with preprocessed code.

In this paper we propose a lightweight approach that enables program-editing tools to work with the C preprocessor for (almost) free. The idea is that program-editing tools now simply target the preprocessed code, and our system, acting as a bidirectional C preprocessor, automatically propagates the changes on the preprocessed code back to the unpreprocessed code. The resulting source code is guaranteed to be correct and is kept similar to the original source as much as possible. We have evaluated our approach on Linux kernel with a set of generated changes. The evaluation results show the feasibility and effectiveness of our approach.
\end{eabstract}

